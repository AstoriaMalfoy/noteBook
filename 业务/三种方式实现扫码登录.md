# 三种方式实现扫码登录

扫码方式通常有三种方式实现,分别为 **轮询** , **长轮询** 和**websocket**.

- **轮询**:网页端按照指定时间间隔不断向服务器发送请求,服务端接收到请求之后马上响应信息并且关闭链接,优点在于后台程序容易编写.缺点是会产生大量无用请求,浪费宽带和服务器资源,并且需要客户端有更快的处理速度

- **长轮询**:网页端向服务器发送请求,服务器接收到请求之后会进行阻塞,直到有新的信息更新,或者超时,网页端接收到请求之后会继续向服务器发送请求.有点在于不会进行频繁发送新的请求,资源消耗较少,缺点在于服务器在阻塞的时候会明显增加资源消耗,并且需要并发处理能力

- **webSocket**:轮询和长轮询均存在无法主动推送数据的缺陷,而webSocket可以做到在网页端和服务器建立链接之后,如果信息发生更新,服务端可以主动推送信息给网页端,有点在于实现了双向通信逻辑,缺点在于后台实现逻辑较为复杂.

$\textcolor{red}{从兼容性上考虑: 轮询 > 长轮询 > websocket}$

$\textcolor{red}{从性能上考虑 : websocket > 长轮询 > 轮询}$

## 轮询

![](https://raw.githubusercontent.com/AstoriaMalfoy/ImageRepository/main/2022/01/13-17-27-48-2021-12-15-17-03-50-image.png)

轮询方式指的是前端会每隔一段实现就主动给服务器发送一次二维码的状态查询请求,后端需要更快的处理速度,争取在下一次请求来之前完成相应,具体流程如上图,其中红色部分为轮询相关操作.

### 长轮询

长轮询指的是前端主动给服务端发送二维码的查询请求,后端会按照情况对请求进行阻塞,直到二维码信息更新或者超时,当前端接收到返回结果后,若二维码仍未被扫描,则会继续发送查询请求,直到状态发生变化(扫描或者失效),具体流程如下,红色部分为长轮询相关操作.

![](https://raw.githubusercontent.com/AstoriaMalfoy/ImageRepository/main/2022/01/13-17-28-02-2021-12-15-19-15-25-image.png)

### webSocket

webSocket指的是前端生成二维码之后,会与后端建立链接,一旦后端的二维码状态发生变化,可以通过建立的链接主动推送信息给前端,具体流程图如下:

![](/Users/astoria/IdeaProjects/githubPro/noteBook/imageDir/d1849e7e465515e917562a1f7ae4d379ada9b80a.png)
