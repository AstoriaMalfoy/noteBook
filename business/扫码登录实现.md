# 扫码登录分析

在扫码登录过程中涉及**三个角色**以及**两个问题**

## 扫码登录三种角色
在扫码登录过程中,涉及的三个角色 : PC页面端,手机端,服务端

在设计过程中主要围绕这三个端来展开,具体的设计其实就是每个端完成什么样的功能,应该如何实现,如何交互

## 两个问题

扫码登录实际上是一种特殊的登录验证方式,核心面临的是两个问题:

* 手机端如何完成验证
* PC端如何完成验证

## 普通PC端登录验证流程

```sequence
PC端->>服务端 : 提交账号密码
服务端 ->> PC端 : 验证通过返回token
PC端 --> 服务端 : 请求携带token进行验证
服务端 --> 服务端 : 校验token
服务端 --> PC端 : 响应(正常/认证失败/过期)
```

普通的PC页面登录流程中,PC端向后端发送账号密码完成验证,然后由服务器同步返回token和key之类的标识,而PC后续请求服务端的时候,需要携带该token,服务端接收后会对该token进行验证来确保登录状态.

当场景换到扫码登录的时候,那么认证阶段就不再是通过PC端提交账号密码进行验证,而是手机端通过扫码来进行验证

PC不在提交账号密码之后就无法同步获取认证成功之后的token信息,那么就必须提供某种机制保证PC端获取认证的凭证



# 扫码登录实现

## 手机端如何完整认证

### $\textcolor{purple}{二维码生成}$

二维码是在PC端进行展示,所以这个阶段主要为PC端请求服务器,获取相应的数据,然后再由PC端生成二维码

### $\textcolor{purple}{二维码内容}$

二维码是在这个场景中一个重要的媒介,要保证唯一性,服务端必须给这个数据生成唯一的标识作为二维码ID,同时还应该设置过期时间,PC根据二维码ID及相关数据生成二维码ID

```sequence
PC端 ->> 服务端 : 发送请求,申请二维码ID
服务端 ->> 服务端 : 生成唯一的二维码ID,存储,并设置过期时间
服务端 ->> PC端 : 返回二维码ID
PC端->>PC端 : 结合二维码ID等信息生成二维码
```

在上述流程中,服务端还要同时保存二维码的相关状态信息 :  $\textcolor{purple}{未扫描}$,$\textcolor{purple}{以成功}$,$\textcolor{purple}{以失效}$

### $\textcolor{purple}{APP端认证机制}$