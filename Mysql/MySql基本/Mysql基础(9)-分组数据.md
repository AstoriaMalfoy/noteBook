# ==分组数据==
使用分组可以将数据分为多个逻辑组,对每个组进行聚集计算

## 创建分组
分组是使用SELECT语句的GROUP BY字句建立的.
`SELECT vend_id , count(*) AS num_prods FROM Products GTOUP BY vend_id;`
上述SQL指定了两个列:GROUP BY字句指示DBMS按照vend_id排列并分组数据,这样就会对每一组vend_id而不是整个表计算num_prods一次.
GROUP BY指示DBMS分组数据,然后对每个组而不是整个结果进行聚集.
在使用GROP BY字句之前,需要明确一些规定:
1. GROUP BY字句可以包含任意数量的列,因而可以对分组进行嵌套,更加细致的对数据进行分组.
2. 如果在GROUP BY字句中嵌套了分组,数据将在最后指定的分组上进行汇总.也就是在建立分组时候,指定的所有列都将一起进行计算.
3. GROUP BY字句中列出的每一列都必须是检索列或者是有效的表达式 **(但是不能是聚集函数)**,如果在SELECT列中使用表达式,则必须在GROUP BY字句中使用相同的表达式,不能使用别名.
4. 大多数SQL实现不允许GROUP BY列带有长度可变的数据类型(如文本或备注型字段)
5. 除聚集计算外,SLECT语句汇总的每一列都必须在GROUP BY字句中给出.
6. 如果分组列中包含具有NULL值的行,则NULL将作为一个分组返回,如果列中有多行NULL,他们将分为一组.
7. GROUP BY字句必须出现在WHERE字句之后,ORDER BY字句之前.
> 有的SQL可以实现根据SELECT列表中的位置指定GROUP BY字句,例如,GROUP BY 1,2 可以表示按照选择的第二列分组,然后在按第一列分组,这种方式虽然方便,但是容易出错,也并非所有的SQL都支持.


# ==分组过滤==
在SQL中出了支持使用GROUP BY进行分组外,还允许过滤分组,规定包括或者排除哪些分组,在进行分组过滤的时候,是不允许使用WHERE进行分组的,而是使用HAVING进行分组,而WHERE和HAVING唯一的区别就是,WHERE是对行进行过滤,而HAVING是对分组进行过滤.
> HAVING 字句支持 WHERE的所有的技术和条件都适用于HAVING,他们呢的语法是相同的,只是关键字有区别.

> 在一些简单的查询中,如果不使用GROUP BY字句,在一定条件下,HAVING关键字可以代替WHERE关键字使用,但是这是极其不建议的.

> HAVING和WHERE的差别:这里有另一种理解,WHERE在数据分组前进行过滤,HAVING在数据分组后进行过滤,还有一个重要的区别就是WHERE排除的行不会包括在分组中,这就意味着WHERE字句可能会改变最后分组的值,而HAVING则不会.

> HAVING和WHERE非常相似,如果不指定GROUP BY,大多数的DBMS都会同等对待,但是开发者在使用的时候应该要能自己区分这一点,使用HAVING时候应该集合GROUP BY字句,而WHERE字句用于标准的行级过滤.

# ==分组排序==
## GROUP BY和ORDER BY的区别
|ORDER BY|GROUP BY|
|:--|:--|
|对产生的数据进行分类|对行进行分组,但是不保证会对相关的列进行排序|
|对任意列都可以使用(甚至非选择的列也可以)|只可以使用选择列或者表达式列,而且必须使用每个选择列表达式|
|不一定需要|如果与聚集函数一起使用列(或表达式),则必须使用|

我们京城发现在使用GROUP BY的使用数据总是以分组顺序输出,但是实际上SQL规范中并没有对这进行规范,此外,即使特定的DBMS总是按照给出的GROUP BY字句进行排序,但是世纪应用也可能使用不同的顺序进行排序,所有在需要对分组进行排序的时候,需要明确的提供ORDER BY字句,即使其效果等效与GROUP BY字句.

# ==SELECT语句顺序==
下表为SELECT语句中相关字句的顺序
|序号|字句|说明|是否必须使用|
|:--|:--|:--|:--|
|1|SELECT|要返回的列或者表达式|是|
|2|FROM|从中检索的数据表|仅在从表中检索数据时使用|
|3|WHERE|行级过滤|否|
|4|GROUP BY|分组说明|仅在按组计算聚集是使用|否|
|5|HAVING|组级过滤|否|
|6|ORDER BY|定义输出顺序|否|
